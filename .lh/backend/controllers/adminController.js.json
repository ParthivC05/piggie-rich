{
    "sourceFile": "backend/controllers/adminController.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 10,
            "patches": [
                {
                    "date": 1751515181931,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1751517124511,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -16,5 +16,53 @@\n     res.json({ deposits });\r\n   } catch (err) {\r\n     res.status(500).json({ error: err.message });\r\n   }\r\n+};\r\n+\r\n+exports.deleteUser = async (req, res) => {\r\n+  try {\r\n+    await User.findByIdAndDelete(req.params.id);\r\n+    res.json({ success: true });\r\n+  } catch (err) {\r\n+    res.status(500).json({ error: err.message });\r\n+  }\r\n+};\r\n+\r\n+exports.blockUser = async (req, res) => {\r\n+  try {\r\n+    const { blocked } = req.body;\r\n+    const user = await User.findByIdAndUpdate(\r\n+      req.params.id,\r\n+      { blocked: !!blocked },\r\n+      { new: true }\r\n+    );\r\n+    res.json({ success: true, user });\r\n+  } catch (err) {\r\n+    res.status(500).json({ error: err.message });\r\n+  }\r\n+};\r\n+\r\n+exports.editUser = async (req, res) => {\r\n+  try {\r\n+    const { username, email, role, phone } = req.body;\r\n+    const user = await User.findByIdAndUpdate(\r\n+      req.params.id,\r\n+      { username, email, role, phone },\r\n+      { new: true }\r\n+    );\r\n+    res.json({ success: true, user });\r\n+  } catch (err) {\r\n+    res.status(500).json({ error: err.message });\r\n+  }\r\n+};\r\n+\r\n+exports.getUserLogs = async (req, res) => {\r\n+  try {\r\n+    const logs = await Deposit.find({ userId: req.params.id })\r\n+      .sort({ createdAt: -1 })\r\n+      .limit(5);\r\n+    res.json({ logs });\r\n+  } catch (err) {\r\n+    res.status(500).json({ error: err.message });\r\n+  }\r\n };\n\\ No newline at end of file\n"
                },
                {
                    "date": 1751537966531,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,68 +1,9 @@\n-const User = require('../models/User');\r\n-const Deposit = require('../models/Deposit');\r\n+const mongoose = require('mongoose');\r\n \r\n-exports.getAllUsers = async (req, res) => {\r\n-  try {\r\n-    const users = await User.find().select('-password');\r\n-    res.json({ users });\r\n-  } catch (err) {\r\n-    res.status(500).json({ error: err.message });\r\n-  }\r\n-};\r\n+const cmsSchema = new mongoose.Schema({\r\n+  privacy: String,\r\n+  terms: String,\r\n+  updatedAt: { type: Date, default: Date.now }\r\n+});\r\n \r\n-exports.getAllDeposits = async (req, res) => {\r\n-  try {\r\n-    const deposits = await Deposit.find().populate('userId', 'username email');\r\n-    res.json({ deposits });\r\n-  } catch (err) {\r\n-    res.status(500).json({ error: err.message });\r\n-  }\r\n-};\r\n-\r\n-exports.deleteUser = async (req, res) => {\r\n-  try {\r\n-    await User.findByIdAndDelete(req.params.id);\r\n-    res.json({ success: true });\r\n-  } catch (err) {\r\n-    res.status(500).json({ error: err.message });\r\n-  }\r\n-};\r\n-\r\n-exports.blockUser = async (req, res) => {\r\n-  try {\r\n-    const { blocked } = req.body;\r\n-    const user = await User.findByIdAndUpdate(\r\n-      req.params.id,\r\n-      { blocked: !!blocked },\r\n-      { new: true }\r\n-    );\r\n-    res.json({ success: true, user });\r\n-  } catch (err) {\r\n-    res.status(500).json({ error: err.message });\r\n-  }\r\n-};\r\n-\r\n-exports.editUser = async (req, res) => {\r\n-  try {\r\n-    const { username, email, role, phone } = req.body;\r\n-    const user = await User.findByIdAndUpdate(\r\n-      req.params.id,\r\n-      { username, email, role, phone },\r\n-      { new: true }\r\n-    );\r\n-    res.json({ success: true, user });\r\n-  } catch (err) {\r\n-    res.status(500).json({ error: err.message });\r\n-  }\r\n-};\r\n-\r\n-exports.getUserLogs = async (req, res) => {\r\n-  try {\r\n-    const logs = await Deposit.find({ userId: req.params.id })\r\n-      .sort({ createdAt: -1 })\r\n\\ No newline at end of file\n-      .limit(5);\r\n-    res.json({ logs });\r\n-  } catch (err) {\r\n-    res.status(500).json({ error: err.message });\r\n-  }\r\n-};\n+module.exports = mongoose.model('CMS', cmsSchema);\n\\ No newline at end of file\n"
                },
                {
                    "date": 1751538349375,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,9 +1,128 @@\n-const mongoose = require('mongoose');\r\n+const User = require('../models/User');\r\n+const Transaction = require('../models/Transaction');\r\n+const CMS = require('../models/CMS');\r\n+const bcrypt = require('bcryptjs');\r\n \r\n-const cmsSchema = new mongoose.Schema({\r\n-  privacy: String,\r\n-  terms: String,\r\n\\ No newline at end of file\n-  updatedAt: { type: Date, default: Date.now }\r\n-});\r\n+// 1. Dashboard stats\r\n+exports.getStats = async (req, res) => {\r\n+  const userCount = await User.countDocuments();\r\n+  const transactionCount = await Transaction.countDocuments();\r\n+  const depositSum = await Transaction.aggregate([\r\n+    { $match: { type: \"deposit\" } },\r\n+    { $group: { _id: null, total: { $sum: \"$amount\" } } }\r\n+  ]);\r\n+  res.json({\r\n+    userCount,\r\n+    transactionCount,\r\n+    totalDeposits: depositSum[0]?.total || 0\r\n+  });\r\n+};\r\n \r\n-module.exports = mongoose.model('CMS', cmsSchema);\n+// 2. User listing\r\n+exports.getAllUsers = async (req, res) => {\r\n+  const users = await User.find().select('-password');\r\n+  res.json({ users });\r\n+};\r\n+\r\n+// 3. User detail\r\n+exports.getUserById = async (req, res) => {\r\n+  const user = await User.findById(req.params.id).select('-password');\r\n+  if (!user) return res.status(404).json({ error: \"User not found\" });\r\n+  res.json({ user });\r\n+};\r\n+\r\n+// 4. Edit user\r\n+exports.editUser = async (req, res) => {\r\n+  const { username, email, role, phone } = req.body;\r\n+  const user = await User.findByIdAndUpdate(\r\n+    req.params.id,\r\n+    { username, email, role, phone },\r\n+    { new: true }\r\n+  );\r\n+  res.json({ success: true, user });\r\n+};\r\n+\r\n+// 5. Block/unblock user\r\n+exports.blockUser = async (req, res) => {\r\n+  const { blocked } = req.body;\r\n+  const user = await User.findByIdAndUpdate(\r\n+    req.params.id,\r\n+    { blocked: !!blocked },\r\n+    { new: true }\r\n+  );\r\n+  res.json({ success: true, user });\r\n+};\r\n+\r\n+// 6. Delete user\r\n+exports.deleteUser = async (req, res) => {\r\n+  await User.findByIdAndDelete(req.params.id);\r\n+  res.json({ success: true });\r\n+};\r\n+\r\n+// 7. Transactions with filtering\r\n+exports.getTransactions = async (req, res) => {\r\n+  const { userId, type, minAmount, maxAmount, startDate, endDate } = req.query;\r\n+  const filter = {};\r\n+  if (userId) filter.userId = userId;\r\n+  if (type) filter.type = type;\r\n+  if (minAmount) filter.amount = { ...filter.amount, $gte: Number(minAmount) };\r\n+  if (maxAmount) filter.amount = { ...filter.amount, $lte: Number(maxAmount) };\r\n+  if (startDate || endDate) {\r\n+    filter.createdAt = {};\r\n+    if (startDate) filter.createdAt.$gte = new Date(startDate);\r\n+    if (endDate) filter.createdAt.$lte = new Date(endDate);\r\n+  }\r\n+  const transactions = await Transaction.find(filter)\r\n+    .populate('userId', 'username email')\r\n+    .sort({ createdAt: -1 });\r\n+  res.json({ transactions });\r\n+};\r\n+\r\n+// 8. CMS get/update\r\n+exports.getCMS = async (req, res) => {\r\n+  let cms = await CMS.findOne();\r\n+  if (!cms) cms = await CMS.create({ privacy: \"\", terms: \"\" });\r\n+  res.json({ privacy: cms.privacy, terms: cms.terms });\r\n+};\r\n+exports.updateCMS = async (req, res) => {\r\n+  let cms = await CMS.findOne();\r\n+  if (!cms) cms = await CMS.create({ privacy: \"\", terms: \"\" });\r\n+  cms.privacy = req.body.privacy;\r\n+  cms.terms = req.body.terms;\r\n+  cms.updatedAt = new Date();\r\n+  await cms.save();\r\n+  res.json({ success: true });\r\n+};\r\n+\r\n+// 9. Access control: add cashier/admin\r\n+exports.addUser = async (req, res) => {\r\n+  const { email, password, role } = req.body;\r\n+  if (!email || !password || !role) return res.status(400).json({ error: \"All fields required\" });\r\n+  const existing = await User.findOne({ email });\r\n+  if (existing) return res.status(400).json({ error: \"Email already exists\" });\r\n+  const hashed = await bcrypt.hash(password, 10);\r\n+  const user = new User({ email, password: hashed, role, username: email });\r\n+  await user.save();\r\n+  res.json({ success: true, user });\r\n+};\r\n+\r\n+// In adminController.js\r\n+exports.getStats = async (req, res) => {\r\n+  const userCount = await User.countDocuments();\r\n+  const transactionCount = await Transaction.countDocuments();\r\n+  const depositSum = await Transaction.aggregate([\r\n+    { $match: { type: \"deposit\" } },\r\n+    { $group: { _id: null, total: { $sum: \"$amount\" } } }\r\n+  ]);\r\n+  const blockedCount = await User.countDocuments({ blocked: true });\r\n+  const cashierCount = await User.countDocuments({ role: \"cashier\" });\r\n+  const adminCount = await User.countDocuments({ role: \"admin\" });\r\n+  res.json({\r\n+    userCount,\r\n+    transactionCount,\r\n+    totalDeposits: depositSum[0]?.total || 0,\r\n+    blockedCount,\r\n+    cashierCount,\r\n+    adminCount,\r\n+  });\r\n+};\n\\ No newline at end of file\n"
                },
                {
                    "date": 1751598564213,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,6 +1,5 @@\n const User = require('../models/User');\r\n-const Transaction = require('../models/Transaction');\r\n const CMS = require('../models/CMS');\r\n const bcrypt = require('bcryptjs');\r\n \r\n // 1. Dashboard stats\r\n"
                },
                {
                    "date": 1751598570850,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4,17 +4,16 @@\n \r\n // 1. Dashboard stats\r\n exports.getStats = async (req, res) => {\r\n   const userCount = await User.countDocuments();\r\n-  const transactionCount = await Transaction.countDocuments();\r\n-  const depositSum = await Transaction.aggregate([\r\n-    { $match: { type: \"deposit\" } },\r\n-    { $group: { _id: null, total: { $sum: \"$amount\" } } }\r\n-  ]);\r\n+  const blockedCount = await User.countDocuments({ blocked: true });\r\n+  const cashierCount = await User.countDocuments({ role: \"cashier\" });\r\n+  const adminCount = await User.countDocuments({ role: \"admin\" });\r\n   res.json({\r\n     userCount,\r\n-    transactionCount,\r\n-    totalDeposits: depositSum[0]?.total || 0\r\n+    blockedCount,\r\n+    cashierCount,\r\n+    adminCount,\r\n   });\r\n };\r\n \r\n // 2. User listing\r\n"
                },
                {
                    "date": 1751598577111,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -56,27 +56,10 @@\n   await User.findByIdAndDelete(req.params.id);\r\n   res.json({ success: true });\r\n };\r\n \r\n-// 7. Transactions with filtering\r\n-exports.getTransactions = async (req, res) => {\r\n-  const { userId, type, minAmount, maxAmount, startDate, endDate } = req.query;\r\n-  const filter = {};\r\n-  if (userId) filter.userId = userId;\r\n-  if (type) filter.type = type;\r\n-  if (minAmount) filter.amount = { ...filter.amount, $gte: Number(minAmount) };\r\n-  if (maxAmount) filter.amount = { ...filter.amount, $lte: Number(maxAmount) };\r\n-  if (startDate || endDate) {\r\n-    filter.createdAt = {};\r\n-    if (startDate) filter.createdAt.$gte = new Date(startDate);\r\n-    if (endDate) filter.createdAt.$lte = new Date(endDate);\r\n-  }\r\n-  const transactions = await Transaction.find(filter)\r\n-    .populate('userId', 'username email')\r\n-    .sort({ createdAt: -1 });\r\n-  res.json({ transactions });\r\n-};\r\n \r\n+\r\n // 8. CMS get/update\r\n exports.getCMS = async (req, res) => {\r\n   let cms = await CMS.findOne();\r\n   if (!cms) cms = await CMS.create({ privacy: \"\", terms: \"\" });\r\n"
                },
                {
                    "date": 1751598582782,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -86,24 +86,4 @@\n   await user.save();\r\n   res.json({ success: true, user });\r\n };\r\n \r\n-// In adminController.js\r\n-exports.getStats = async (req, res) => {\r\n-  const userCount = await User.countDocuments();\r\n-  const transactionCount = await Transaction.countDocuments();\r\n-  const depositSum = await Transaction.aggregate([\r\n-    { $match: { type: \"deposit\" } },\r\n-    { $group: { _id: null, total: { $sum: \"$amount\" } } }\r\n-  ]);\r\n-  const blockedCount = await User.countDocuments({ blocked: true });\r\n-  const cashierCount = await User.countDocuments({ role: \"cashier\" });\r\n-  const adminCount = await User.countDocuments({ role: \"admin\" });\r\n-  res.json({\r\n-    userCount,\r\n-    transactionCount,\r\n-    totalDeposits: depositSum[0]?.total || 0,\r\n-    blockedCount,\r\n-    cashierCount,\r\n-    adminCount,\r\n-  });\r\n-};\n\\ No newline at end of file\n"
                },
                {
                    "date": 1751598987289,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -30,12 +30,12 @@\n };\r\n \r\n // 4. Edit user\r\n exports.editUser = async (req, res) => {\r\n-  const { username, email, role, phone } = req.body;\r\n+  const { username, email, role, phone, firstName, lastName, dob } = req.body;\r\n   const user = await User.findByIdAndUpdate(\r\n     req.params.id,\r\n-    { username, email, role, phone },\r\n+    { username, email, role, phone, firstName, lastName, dob },\r\n     { new: true }\r\n   );\r\n   res.json({ success: true, user });\r\n };\r\n"
                },
                {
                    "date": 1751599433601,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,6 +1,7 @@\n const User = require('../models/User');\r\n const CMS = require('../models/CMS');\r\n+const Deposit = require('../models/Deposit');\r\n const bcrypt = require('bcryptjs');\r\n \r\n // 1. Dashboard stats\r\n exports.getStats = async (req, res) => {\r\n"
                },
                {
                    "date": 1751599442299,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -57,10 +57,32 @@\n   await User.findByIdAndDelete(req.params.id);\r\n   res.json({ success: true });\r\n };\r\n \r\n+// 7. Get all deposits with filtering\r\n+exports.getDeposits = async (req, res) => {\r\n+  const { userId, game, minAmount, maxAmount, startDate, endDate, status } = req.query;\r\n+  const filter = {};\r\n+  \r\n+  if (userId) filter.userId = userId;\r\n+  if (game) filter.game = { $regex: game, $options: 'i' };\r\n+  if (minAmount) filter.amount = { ...filter.amount, $gte: Number(minAmount) };\r\n+  if (maxAmount) filter.amount = { ...filter.amount, $lte: Number(maxAmount) };\r\n+  if (status) filter.status = status;\r\n+  if (startDate || endDate) {\r\n+    filter.createdAt = {};\r\n+    if (startDate) filter.createdAt.$gte = new Date(startDate);\r\n+    if (endDate) filter.createdAt.$lte = new Date(endDate);\r\n+  }\r\n+  \r\n+  const deposits = await Deposit.find(filter)\r\n+    .populate('userId', 'username email firstName lastName')\r\n+    .sort({ createdAt: -1 });\r\n+  res.json({ deposits });\r\n+};\r\n \r\n \r\n+\r\n // 8. CMS get/update\r\n exports.getCMS = async (req, res) => {\r\n   let cms = await CMS.findOne();\r\n   if (!cms) cms = await CMS.create({ privacy: \"\", terms: \"\" });\r\n"
                }
            ],
            "date": 1751515181931,
            "name": "Commit-0",
            "content": "const User = require('../models/User');\r\nconst Deposit = require('../models/Deposit');\r\n\r\nexports.getAllUsers = async (req, res) => {\r\n  try {\r\n    const users = await User.find().select('-password');\r\n    res.json({ users });\r\n  } catch (err) {\r\n    res.status(500).json({ error: err.message });\r\n  }\r\n};\r\n\r\nexports.getAllDeposits = async (req, res) => {\r\n  try {\r\n    const deposits = await Deposit.find().populate('userId', 'username email');\r\n    res.json({ deposits });\r\n  } catch (err) {\r\n    res.status(500).json({ error: err.message });\r\n  }\r\n};"
        }
    ]
}